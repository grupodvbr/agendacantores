<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Agenda de M√∫sicos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin:0;
      font-family: 'Poppins', sans-serif;
      background:url('https://cdn.venngage.com/template/thumbnail/small/16d941ee-2e8e-49ac-889c-208297e1daad.webp') no-repeat center center/cover;
      color:#fff;
    }
    .overlay {
      background:rgba(10,0,30,0.75);
      min-height:100vh;
      padding:20px;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    .titulo {
      text-align:center;
      margin-bottom:10px;
      position:relative;
      width:100%;
    }
    .titulo h1 {
      font-size:38px;
      font-weight:900;
      color:#ffd700;
      margin:0;
    }
    .titulo h2 {
      font-size:22px;
      font-weight:600;
      margin:5px 0 0;
      font-style:italic;
    }
    /* Bot√£o l√°pis */
    #editBtn {
      position:absolute;
      top:0;
      right:10px;
      font-size:20px;
      cursor:pointer;
      color:#ffd700;
    }
    /* Filtro datas */
    .filtro {
      margin:10px 0 30px;
      font-size:14px;
      color:#ddd;
    }
    .filtro input {
      padding:5px;
      border-radius:6px;
      border:none;
    }
    .lista {
      max-width:500px;
      width:100%;
    }
    .evento {
      display:flex;
      align-items:center;
      margin:18px 0;
    }
    .data {
      width:70px;
      text-align:center;
      font-weight:bold;
      font-size:22px;
      color:#fff;
    }
    .data span {
      display:block;
      font-size:14px;
      color:#ffd700;
    }
    .detalhes {
      border-left:3px solid #ffd700;
      padding-left:15px;
      margin-left:10px;
      flex:1;
    }
    .detalhes h3 {
      margin:0;
      font-size:18px;
      font-weight:700;
    }
    .detalhes p {
      margin:2px 0;
      font-size:14px;
      color:#ddd;
    }
    /* Modal login */
    #loginModal {
      position:fixed; inset:0;
      background:rgba(0,0,0,.8);
      display:flex; align-items:center; justify-content:center;
      z-index:1000;
    }
    #loginBox {
      background:#fff; color:#000; padding:20px;
      border-radius:12px; width:320px;
    }
    #loginBox h2 { margin-top:0 }
    #loginBox label { display:block; margin-top:10px; }
    #loginBox input { width:100%; padding:8px; margin-top:4px;
      border:1px solid #ccc; border-radius:6px; }
    #loginMsg { color:red; margin-top:8px; font-size:14px; }
    button {
      padding:6px 12px; border:none; border-radius:6px;
      background:#ffd700; font-weight:bold; cursor:pointer;
      margin-top:6px;
    }
    /* Painel admin */
    #adminPanel {
      position:fixed; inset:0;
      background:rgba(0,0,0,.85);
      display:none; align-items:center; justify-content:center;
      z-index:2000;
    }
    #adminBox {
      background:#fff; color:#000; padding:20px;
      border-radius:12px; width:90%; max-width:600px;
      max-height:80vh; overflow:auto;
    }
    #adminBox h2 { margin-top:0 }
    table { width:100%; border-collapse:collapse; font-size:14px; }
    th, td { border:1px solid #ccc; padding:6px; text-align:left; }
    .actions button { margin-right:4px; }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="titulo">
      <h1>M√∫sicos da Semana</h1>
      <h2 id="empresaNome"></h2>
      <span id="editBtn" title="Gerenciar">‚úèÔ∏è</span>
    </div>

    <div class="filtro">
      <label>De: <input type="date" id="dataDe"></label>
      <label>At√©: <input type="date" id="dataAte"></label>
      <button onclick="filtrarAgenda()">Filtrar</button>
    </div>

    <div class="lista" id="agenda"></div>
  </div>

  <!-- Painel Admin -->
  <div id="adminPanel">
    <div id="adminBox">
      <h2>Gerenciar Agenda</h2>
      <table id="tabelaAdmin">
        <thead>
          <tr><th>Data</th><th>Hora</th><th>Cantor</th><th>Valor</th><th>A√ß√µes</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <button onclick="fecharAdmin()">Fechar</button>
    </div>
  </div>

  <!-- Login -->
  <div id="loginModal">
    <div id="loginBox">
      <h2>Login Empresa</h2>
      <label>Senha</label>
      <input type="password" id="senha">
      <button onclick="login()">Entrar</button>
      <p id="loginMsg"></p>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzdkG1SxDulc0UDbf4PYwBvMQoJI1sDRQZ33VnJOLCS1pU_autY_CPULkm2usC9vfvW/exec"; 
let empresa = null;

// Senhas fixas no front
const SENHAS = {
  "1234": "Mercatto Del√≠cia",
  "5678": "Villa Gourmet",
  "9999": "Del√≠cia Gourmet"
};

// ===== LOGIN =====
function verificarLogin(){
  const e = localStorage.getItem("empresa");
  if(e){
    empresa = e;
    document.getElementById("loginModal").style.display="none";
    document.getElementById("empresaNome").textContent = empresa;
    carregarAgenda();
  }
}
function login(){
  const senha = document.getElementById("senha").value;
  if(SENHAS[senha]){
    empresa = SENHAS[senha];
    localStorage.setItem("empresa", empresa);
    document.getElementById("empresaNome").textContent = empresa;
    document.getElementById("loginModal").style.display="none";
    carregarAgenda();
  }else{
    document.getElementById("loginMsg").textContent = "Senha incorreta!";
  }
}

// ===== LISTAGEM =====
async function carregarAgenda(filtroDe=null, filtroAte=null){
  const lista = document.getElementById("agenda");
  lista.innerHTML="<p>Carregando...</p>";
  const res = await fetch(API_URL+"?empresa="+encodeURIComponent(empresa));
  let eventos = await res.json();

  // aplica filtro por data
  if(filtroDe && filtroAte){
    const de = new Date(filtroDe);
    const ate = new Date(filtroAte);
    eventos = eventos.filter(ev=>{
      const d = new Date(ev.data);
      return d >= de && d <= ate;
    });
  }

  lista.innerHTML="";
  eventos.forEach(ev=>{
    const d = new Date(ev.data);
    const dia = d.getDate().toString().padStart(2,"0");
    const mes = d.toLocaleString("pt-BR",{month:"short"});
    lista.innerHTML += `
      <div class="evento">
        <div class="data">${dia}<span>${mes.toUpperCase()}</span></div>
        <div class="detalhes">
          <h3>${ev.cantor}</h3>
          <p>${ev.hora} - R$ ${ev.valor}</p>
        </div>
      </div>`;
  });
}
function filtrarAgenda(){
  const de = document.getElementById("dataDe").value;
  const ate = document.getElementById("dataAte").value;
  if(de && ate) carregarAgenda(de, ate);
}

// ===== ADMIN =====
document.getElementById("editBtn").addEventListener("click", abrirAdmin);

async function abrirAdmin(){
  const res = await fetch(API_URL+"?empresa="+encodeURIComponent(empresa));
  const eventos = await res.json();
  const tbody = document.querySelector("#tabelaAdmin tbody");
  tbody.innerHTML="";
  eventos.forEach(ev=>{
    tbody.innerHTML += `
      <tr>
        <td><input type="date" value="${ev.data}" data-row="${ev.row}" data-field="data"></td>
        <td><input type="time" value="${ev.hora}" data-row="${ev.row}" data-field="hora"></td>
        <td><input type="text" value="${ev.cantor}" data-row="${ev.row}" data-field="cantor"></td>
        <td><input type="number" value="${ev.valor}" data-row="${ev.row}" data-field="valor"></td>
        <td class="actions">
          <button onclick="salvar(${ev.row})">üíæ</button>
          <button onclick="excluir(${ev.row})">üóëÔ∏è</button>
        </td>
      </tr>`;
  });
  document.getElementById("adminPanel").style.display="flex";
}
function fecharAdmin(){
  document.getElementById("adminPanel").style.display="none";
  carregarAgenda();
}

// Atualizar evento
async function salvar(row){
  const inputs = document.querySelectorAll(`[data-row='${row}']`);
  const body = {row: row, empresa: empresa};
  inputs.forEach(inp=> body[inp.dataset.field] = inp.value);

  await fetch(API_URL, {
    method: "PUT",
    body: JSON.stringify(body),
    headers: {"Content-Type":"application/json"}
  });
  alert("Atualizado!");
}

// Excluir evento
async function excluir(row){
  if(!confirm("Deseja excluir este evento?")) return;
  await fetch(API_URL, {
    method: "DELETE",
    body: JSON.stringify({row: row}),
    headers: {"Content-Type":"application/json"}
  });
  alert("Exclu√≠do!");
  abrirAdmin();
}

verificarLogin();
</script>
</body>
</html>
