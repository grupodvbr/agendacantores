<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Agenda de M√∫sicos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Flatpickr (calend√°rio) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    :root{
      --amarelo:#ffd700;
      --overlay:rgba(10,0,30,.75);
      --texto:#fff;
      --muted:#ddd;
    }
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:url('https://cdn.venngage.com/template/thumbnail/small/16d941ee-2e8e-49ac-889c-208297e1daad.webp') no-repeat center center/cover;
      color:var(--texto);
    }
    .overlay{
      min-height:100vh; background:var(--overlay);
      padding:20px; display:flex; flex-direction:column; align-items:center;
    }
    .titulo{ width:100%; max-width:720px; position:relative; text-align:center; }
    .titulo h1{ margin:0; color:var(--amarelo); font-weight:900; font-size:38px; letter-spacing:.5px; }
    .titulo h2{ margin:6px 0 0; font-weight:600; font-size:20px; font-style:italic; }

    /* Bot√µes no topo */
    .top-actions{ position:absolute; top:0; right:0; display:flex; gap:8px; }
    .btn{
      appearance:none; border:none; border-radius:8px; cursor:pointer;
      background:var(--amarelo); color:#000; font-weight:700;
      padding:6px 10px; line-height:1;
    }
    #calendarBtn{ min-width:36px; padding:6px 8px; } /* s√≥ emoji üìÖ */

    /* Lista agrupada */
    .lista{ width:100%; max-width:720px; margin-top:26px; }
    .grupo{ display:grid; grid-template-columns:90px 1fr; gap:12px; margin:16px 0; }
    .dia{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-weight:800; font-size:26px; color:#fff; text-transform:uppercase;
    }
    .dia small{ margin-top:2px; color:var(--amarelo); font-size:12px; letter-spacing:.8px; }
    .itens{
      border-left:3px solid var(--amarelo); padding-left:14px;
      display:flex; flex-direction:column; gap:8px;
    }
    .linha{
      display:flex; align-items:center; justify-content:space-between;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      padding:8px 10px; border-radius:10px;
    }
    .linha .info{ color:var(--muted); font-size:14px; }
    .linha .titulo-item{ font-weight:700; color:#fff; }
    .linha .valor{ margin-left:10px; font-weight:800; color:#fff; white-space:nowrap; }
    .linha .sep{ margin:0 6px; opacity:.6; }

    /* Modal Login */
    #loginModal{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.8); z-index:1000;
    }
    #loginBox{
      width:320px; background:#fff; color:#000; padding:20px; border-radius:12px;
    }
    #loginBox h3{ margin:0 0 10px; }
    #loginBox label{ display:block; margin-top:8px; font-size:14px; }
    #loginBox input{ width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; margin-top:4px; }
    #loginMsg{ color:#c62828; font-size:13px; margin-top:6px; }

    @media (max-width:560px){
      .grupo{ grid-template-columns:70px 1fr; }
      .dia{ font-size:22px; }
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div class="titulo">
      <h1>M√∫sicos da Semana</h1>
      <h2 id="empresaNome"></h2>

      <div class="top-actions">
        <!-- (opcional) l√°pis para gest√£o; comente se n√£o usar -->
        <!-- <button class="btn" title="Gerenciar">‚úèÔ∏è</button> -->
        <button id="calendarBtn" class="btn" title="Selecionar per√≠odo">üìÖ</button>
      </div>
    </div>

    <div class="lista" id="lista"></div>
  </div>

  <!-- Login -->
  <div id="loginModal">
    <div id="loginBox">
      <h3>Login da Empresa</h3>
      <label>Senha</label>
      <input type="password" id="senha" placeholder="Digite a senha">
      <button class="btn" style="margin-top:12px" onclick="login()">Entrar</button>
      <div id="loginMsg"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script>
  // ================== CONFIG ==================
  const API_URL = "https://script.google.com/macros/s/AKfycbzdkG1SxDulc0UDbf4PYwBvMQoJI1sDRQZ33VnJOLCS1pU_autY_CPULkm2usC9vfvW/exec"; // <-- troque pela sua
  const SENHAS = { "1234":"Mercatto Del√≠cia", "5678":"Villa Gourmet", "9999":"Del√≠cia Gourmet" };
  let EMPRESA = null;

  // ================== LOGIN ==================
  function verificarLogin(){
    const e = localStorage.getItem("empresa");
    if(e){
      EMPRESA = e;
      document.getElementById('empresaNome').textContent = EMPRESA;
      document.getElementById('loginModal').style.display = "none";
      carregarAgenda();
    }
  }
  function login(){
    const s = document.getElementById('senha').value.trim();
    if(SENHAS[s]){
      EMPRESA = SENHAS[s];
      localStorage.setItem("empresa", EMPRESA);
      document.getElementById('empresaNome').textContent = EMPRESA;
      document.getElementById('loginModal').style.display = "none";
      carregarAgenda();
    }else{
      document.getElementById('loginMsg').textContent = "Senha incorreta.";
    }
  }

  // ================== HELPERS ==================
  function pad2(n){ return n.toString().padStart(2,'0'); }

  // aceita "21:5", "21:05", "21:05:00", "21.05", etc ‚Üí "21:05"
  function formatHora(str){
    if(!str) return "";
    let t = String(str).trim();
    t = t.replace('.', ':');
    // se vier como ISO (ex: "2025-09-12T21:00:00Z"), tenta extrair HH:mm
    const mIso = t.match(/T(\d{2}):(\d{2})/);
    if(mIso) return `${mIso[1]}:${mIso[2]}`;
    const m = t.match(/(\d{1,2})[:hH\.]?(\d{1,2})?/);
    if(!m) return t;
    const hh = pad2(Math.min(23, parseInt(m[1],10)));
    const mm = pad2(Math.min(59, parseInt(m[2]||"0",10)));
    return `${hh}:${mm}`;
  }
  function formatValor(v){
    const n = Number(v);
    if(Number.isFinite(n)) return n.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    return `R$ ${v}`;
  }
  function keyData(iso){
    // normaliza para yyyy-mm-dd (sem hora) para agrupar
    const d = new Date(iso);
    const y = d.getFullYear(), m = pad2(d.getMonth()+1), dd = pad2(d.getDate());
    return `${y}-${m}-${dd}`;
  }
  function labelDia(iso){
    const d = new Date(iso);
    const dia = pad2(d.getDate());
    const mes = d.toLocaleString('pt-BR',{month:'short'}).replace('.','');
    return {dia, mes: mes.toUpperCase()};
  }

  // ================== LISTAGEM ==================
  async function carregarAgenda(inicio=null, fim=null){
    const box = document.getElementById('lista');
    box.innerHTML = "<p style='opacity:.8'>Carregando...</p>";

    const res = await fetch(`${API_URL}?empresa=${encodeURIComponent(EMPRESA)}`);
    let eventos = await res.json();

    // filtro per√≠odo (se houver)
    if(inicio && fim){
      const de = new Date(inicio), ate = new Date(fim);
      eventos = eventos.filter(ev=>{
        const d = new Date(ev.data);
        return d >= de && d <= ate;
      });
    }

    // ordena por data e hora
    eventos.sort((a,b)=>{
      const da = new Date(a.data) - new Date(b.data);
      if(da !== 0) return da;
      return formatHora(a.hora).localeCompare(formatHora(b.hora));
    });

    // agrupa por dia
    const grupos = {};
    for(const ev of eventos){
      const k = keyData(ev.data);
      if(!grupos[k]) grupos[k] = [];
      grupos[k].push(ev);
    }

    // render
    box.innerHTML = "";
    const diasOrdenados = Object.keys(grupos).sort();
    if(diasOrdenados.length === 0){
      box.innerHTML = "<p style='opacity:.8'>Sem eventos no per√≠odo.</p>";
      return;
    }

    for(const k of diasOrdenados){
      const {dia, mes} = labelDia(k);
      const itens = grupos[k]
        .map(ev=>{
          const hora = formatHora(ev.hora);
          const valor = formatValor(ev.valor);
          // cantor ‚Äì 22:20 ‚Äì R$ 500
          return `
            <div class="linha">
              <div class="titulo-item">
                ${ev.cantor} <span class="sep">-</span> <span class="info">${hora}</span> <span class="sep">-</span> <span class="valor">${valor}</span>
              </div>
            </div>`;
        }).join("");

      box.innerHTML += `
        <div class="grupo">
          <div class="dia">${dia}<small>${mes}</small></div>
          <div class="itens">${itens}</div>
        </div>`;
    }
  }

  // ================== CALEND√ÅRIO ==================
  // Bot√£o com emoji üìÖ abre o seletor de intervalo
  const btn = document.getElementById('calendarBtn');
  const fp = flatpickr(btn, {
    mode: "range",
    dateFormat: "Y-m-d",
    onClose: (dates)=>{
      if(dates.length===2){
        carregarAgenda(dates[0], dates[1]);
      }
    }
  });

  // start
  verificarLogin();
  </script>
</body>
</html>
