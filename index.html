<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Agenda de Músicos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body{margin:0;font-family:'Inter',sans-serif;background:#0b0f29;color:#fff;}
    header{text-align:center;padding:20px;position:relative;}
    header img{height:70px;margin-bottom:10px;}
    header h1{margin:0;color:#ffd700;font-size:24px;}
    #editBtn{position:absolute;top:20px;right:20px;cursor:pointer;font-size:20px;}
    .agenda{max-width:650px;margin:20px auto;background:rgba(255,255,255,.05);padding:20px;border-radius:16px;}
    .evento{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1);padding:10px 0;}
    .data{text-align:center;width:70px;font-weight:bold;color:#ffd700;}
    .info{flex:1;margin-left:15px;}
    .info h3{margin:0;}
    .novo{text-align:center;margin:20px;}
    button{padding:10px 20px;border:none;border-radius:8px;background:#ffd700;font-weight:bold;cursor:pointer;}
    #formModal,#loginModal,#editModal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:1000;}
    .box{background:#fff;color:#000;padding:20px;border-radius:12px;width:320px;max-height:80vh;overflow:auto;}
    .box h2{margin-top:0;}
    label{display:block;margin-top:10px;}
    input{width:100%;padding:8px;margin-top:4px;border:1px solid #ccc;border-radius:6px;}
    .registro{border:1px solid #ddd;padding:10px;margin:8px 0;border-radius:8px;}
    .registro button{margin-top:6px;}
  </style>
</head>
<body>

  <header>
    <img src="SUA_LOGO.png">
    <h1>Agenda de Músicos</h1>
    <span id="editBtn" onclick="abrirEdicao()">✏️</span>
  </header>

  <div class="agenda" id="agenda"></div>
  <div class="novo"><button onclick="abrirForm()">➕ Criar Agenda</button></div>

  <!-- Login -->
  <div id="loginModal">
    <div class="box">
      <h2>Login Empresa</h2>
      <label>Senha</label>
      <input type="password" id="senha">
      <button onclick="login()">Entrar</button>
      <p id="loginMsg" style="color:red"></p>
    </div>
  </div>

  <!-- Novo evento -->
  <div id="formModal">
    <div class="box">
      <h2>Novo Evento</h2>
      <label>Cantor</label><input type="text" id="cantor">
      <label>Data</label><input type="date" id="data">
      <label>Hora</label><input type="time" id="hora">
      <label>Valor</label><input type="number" id="valor">
      <div style="margin-top:10px;text-align:right">
        <button onclick="salvarAgenda()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Editar registros -->
  <div id="editModal">
    <div class="box">
      <h2>Editar Registros</h2>
      <div id="listaEdit"></div>
    </div>
  </div>

<script>
const API_URL = "SUA_URL_APPS_SCRIPT"; 
let empresa = null;

// ========== LOGIN ==========
function verificarLogin(){
  const e = localStorage.getItem("empresa");
  if(e){ empresa = e; carregarAgenda(); }
  else{ document.getElementById("loginModal").style.display="flex"; }
}

async function login(){
  const senha = document.getElementById("senha").value;
  const r = await fetch(API_URL+"?login=1&senha="+senha);
  const data = await r.json();
  if(data.ok){
    empresa = data.empresa;
    localStorage.setItem("empresa",empresa);
    document.getElementById("loginModal").style.display="none";
    carregarAgenda();
  }else{
    document.getElementById("loginMsg").textContent = "Senha incorreta!";
  }
}

// ========== LISTAGEM ==========
async function carregarAgenda(){
  const agendaBox = document.getElementById("agenda");
  agendaBox.innerHTML="<p>Carregando...</p>";
  const res = await fetch(API_URL+"?empresa="+empresa);
  const eventos = await res.json();
  agendaBox.innerHTML="";
  eventos.forEach((ev,i)=>{
    agendaBox.innerHTML+=`
      <div class="evento">
        <div class="data">${new Date(ev.data).getDate()}<br><small>${new Date(ev.data).toLocaleString('pt-BR',{month:'short'})}</small></div>
        <div class="info"><h3>${ev.cantor}</h3><p>${ev.hora} - R$ ${ev.valor}</p></div>
      </div>`;
  });
}

// ========== NOVO ==========
function abrirForm(){ document.getElementById("formModal").style.display="flex"; }
function fecharForm(){ document.getElementById("formModal").style.display="none"; }
async function salvarAgenda(){
  const body = {
    empresa,
    cantor:document.getElementById("cantor").value,
    data:document.getElementById("data").value,
    hora:document.getElementById("hora").value,
    valor:document.getElementById("valor").value
  };
  await fetch(API_URL,{method:"POST",body:JSON.stringify(body),headers:{'Content-Type':'application/json'}});
  fecharForm(); carregarAgenda();
}

// ========== EDIÇÃO ==========
async function abrirEdicao(){
  const res = await fetch(API_URL+"?empresa="+empresa);
  const eventos = await res.json();
  const lista = document.getElementById("listaEdit");
  lista.innerHTML="";
  eventos.forEach((ev,i)=>{
    lista.innerHTML+=`
      <div class="registro">
        <label>Cantor</label><input id="e_cantor${i}" value="${ev.cantor}">
        <label>Data</label><input type="date" id="e_data${i}" value="${ev.data}">
        <label>Hora</label><input type="time" id="e_hora${i}" value="${ev.hora}">
        <label>Valor</label><input type="number" id="e_valor${i}" value="${ev.valor}">
        <button onclick="salvarEdicao(${i},'${ev.row}')">Salvar</button>
      </div>`;
  });
  document.getElementById("editModal").style.display="flex";
}
async function salvarEdicao(i,row){
  const body={
    row,
    empresa,
    cantor:document.getElementById("e_cantor"+i).value,
    data:document.getElementById("e_data"+i).value,
    hora:document.getElementById("e_hora"+i).value,
    valor:document.getElementById("e_valor"+i).value
  };
  await fetch(API_URL+"?edit=1",{method:"POST",body:JSON.stringify(body),headers:{'Content-Type':'application/json'}});
  alert("Atualizado!");
  document.getElementById("editModal").style.display="none";
  carregarAgenda();
}

verificarLogin();
</script>
</body>
</html>
